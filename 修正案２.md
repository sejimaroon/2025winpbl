# 修正計画案２

## 1. ボタン配置の変更 ✅
- [x] **返信ボタンの位置変更**:
    - 1行目: 「確認した」「作業中」「解決済み」
    - 2行目: 大きく「返信する」ボタン（モバイルで見やすい）

## 2. 記事の編集・削除機能の再実装 ✅
- [x] **DiaryDetailModal の確認・修正**:
    - ヘッダークリック時にモーダルが開く
    - 入力者（staff_id）と管理者（system_role_id === 1）のみ編集・削除ボタンを表示
    - `isAdmin` プロパティを追加して正しく渡す

## 3. マイページの作成 ✅
- [x] **新規ページ `/mypage`**:
    - プロフィール表示（名前、メールアドレス、職種、役割、登録日）
    - 現在のポイント数（ハートアイコン付き）
    - ポイント獲得ルール説明
    - ポイント履歴の簡易表示（直近10件）
- [x] **設定メニューに「マイページ」リンク追加**

## 4. ハートボタンの機能 ✅
- [x] **ヘッダーのハートをボタン化**:
    - クリックで `/points` ページへ遷移
    - ホバー時にスタイル変更
- [x] **ポイント詳細ページ `/points` 改善**:
    - 現在のポイント数（大きくグラデーション表示）
    - ポイント履歴一覧（日付、アクション、ポイント増減）

## 5. ランキング機能 ✅
- [x] **新規ページ `/ranking`**:
    - ポイントランキングTop10表示
    - 1〜3位は特別なスタイル（金・銀・銅メダル）
- [x] **フィルタリング機能（プルダウン）**:
    - 分野別（診察、看護、事務、その他）
    - 期間（全期間、今週、今月、先月）
    - 曜日別（日〜土）
    - 時間帯（午前の部：0-12時、午後の部：12-24時）
- [x] **設定メニューに「ランキング」リンク追加**

---

## 実装ステップ

### ステップ1: ボタン配置の変更 ✅
- `DiaryCard.tsx` のボタン順序変更
- 1行目に確認・作業中・解決、2行目に返信ボタン

### ステップ2: 記事編集・削除機能の確認・修正 ✅
- `DiaryDetailModal.tsx` に `isAdmin` プロパティ追加
- `DiaryListClient.tsx` から `isAdmin` を渡す

### ステップ3: マイページ作成 ✅
- `/mypage/page.tsx` 新規作成
- プロフィール、ポイント、履歴表示

### ステップ4: ポイントページ改善 ✅
- `/points/page.tsx` に現在ポイント大きく表示追加
- ヘッダーのハートをLink化

### ステップ5: ランキングページ作成 ✅
- `/ranking/page.tsx` 新規作成
- `src/app/actions/ranking.ts` 新規作成（フィルタ対応）
- フィルタリングUI（プルダウン4種）
- Top10表示（職種別アイコン色対応）

---

## 進捗状況

| ステップ | 項目 | 状態 |
|---------|------|------|
| 1 | ボタン配置の変更 | ✅ 完了 |
| 2 | 記事編集・削除機能 | ✅ 完了 |
| 3 | マイページ作成 | ✅ 完了 |
| 4 | ポイントページ改善 | ✅ 完了 |
| 5 | ランキング機能 | ✅ 完了 |

---

## 新規作成ファイル

- `src/app/mypage/page.tsx` - マイページ
- `src/app/ranking/page.tsx` - ランキングページ
- `src/app/actions/ranking.ts` - ランキング取得 Server Action

## 修正ファイル

- `src/components/diary/DiaryCard.tsx` - ボタン配置変更
- `src/components/diary/DiaryDetailModal.tsx` - isAdmin プロパティ追加
- `src/components/diary/DiaryListClient.tsx` - isAdmin を渡す
- `src/components/layout/Header.tsx` - マイページ/ランキングリンク追加、ハートボタン化
- `src/app/points/page.tsx` - 現在ポイント大きく表示

---

## 追加修正（2回目） ✅

### 6. マイページでのプロフィール編集機能 ✅
- [x] **本人が編集できる項目**:
    - 名前
    - メールアドレス
    - ログインパスワード
- [x] **管理者のみ編集できる項目**:
    - 職種
    - 管理者かどうか（system_role）
- [x] **Server Action 追加**:
    - `updateProfile` - 本人用
    - `updatePassword` - パスワード変更用
    - `updateStaffByAdmin` - 管理者用

### 7. ランキングの修正 ✅
- [x] **Top10 → Top5 に変更**
- [x] **デフォルト期間を「先月」に変更**
- [x] **ランキングデータが表示されない問題の修正**:
    - 全期間の場合は現在のポイント（current_points）を使用
    - クエリをシンプル化して確実にデータ取得

---

## 追加進捗状況

| ステップ | 項目 | 状態 |
|---------|------|------|
| 6 | マイページ編集機能 | ✅ 完了 |
| 7 | ランキング修正 | ✅ 完了 |

---

## 追加作成ファイル

- `src/app/actions/profile.ts` - プロフィール更新 Server Action
